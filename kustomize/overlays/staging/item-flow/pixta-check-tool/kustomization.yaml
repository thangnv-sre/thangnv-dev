bases:
  - ../../../../base/item-flow/pixta-check-tool
resources:
  - ingress.yaml
  - secret.yaml
  # - batch/cronjob.yaml
configMapGenerator:
  - name: check-tool-application-env
    behavior: merge
    literals:
      - RAILS_ENV=staging
      - UNICORN_WORKER_PROCESSES='2'
      - UNICORN_TIMEOUT='300'
  - name: check-tool-downloader-application-env
    behavior: merge
    literals:
      - RAILS_ENV=staging
      - DATABASE_HOST=pixtastaging-vpc-rds.pixta.jp
      - DATABASE_DBNAME=pixtamigration
      - HEALTH_CHECK_BASIC_AUTH_USERNAME=pixta-downloader
      - HEALTH_CHECK_BASIC_AUTH_PASSWORD=pixtavietnam
  - name: check-tool-nginx-env
    literals:
      - NGINX_HTTP_HOST="$http_host"
      - NGINX_VPN_RANGE="10.0.0.0/16"
      - NGINX_SERVER_NAME="check-staging.pixta.jp staging-checktool.pixta.jp"
  - name: check-tool-downloader-nginx-env
    literals:
      - NGINX_HTTP_HOST="$http_host"
      - NGINX_RESOLVER_HOST="10.0.0.2"
      - NGINX_SERVER_NAME="download-check-staging.pixta.jp download-check-staging.pixtastock.com"
  - name: restore-db-snapshot-config
    files:
      - configmap/checktool_db_info
      - configmap/checktool_rds_restore.sh
      - configmap/functions
generatorOptions:
  disableNameSuffixHash: false
patchesStrategicMerge:
  - deployment_patch.yaml
  - service_patch.yaml
  - delayed_job_patch.yaml
  - polling_patch.yaml
  # - batch/cronjob_patch.yaml
  # - batch/deployment_patch.yaml
